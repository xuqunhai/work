<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>小企儿1岁啦</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/themes/prism.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="./css/1.css">
  <link rel="prefetch" href="./media/2.mp4" />
  <style>
    .token.selector,
    .token.property,
    .token.function {
      color: black;
    }

    #code {
      height: 100vh;
      overflow: hidden;
    }

    #showPic {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      z-index: 2;
    }

    .dsn {
      display: none;
    }

    #showBig {
      width: 100%;
    }

    .video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
    }

    .videoBox {
      position: absolute;
      width: 100vw;
      height: 100vh;
      z-index: 2;
      transform: translateX(-102%);
    }

    .videoBoxL {
      transform: translateX(0%);
    }

    .close {
      position: absolute;
      z-index: 1;
      font-size: 30px;
      font-weight: 700;
      color: #fff;
      top: 20px;
      right: 20px;
    }
  </style>
  <style>
    .loveSvg {
      position: absolute;
      top: 0;
      z-index: 1;
    }
  </style>
  <style id="styleTag"></style>
</head>

<body>
  <div class="videoBox">
    <i class="close">X</i>
    <video src="./media/2.mp4" class="video" controls="controls"></video>
  </div>
  <div id="loveSvg" class="loveSvg dsn">
    <svg height="320" width="320" class="like" onclick="loveSvg.classList.toggle('liked')">
      <path class="path" d="M 160 145 c 15 -90 170 -20 0 90 m 0 -90 c -15 -90 -170 -20 0 90" fill="white">
        <!-- 80 by 70 -->
    </svg>
    <!-- DECORATIONS (quite a lot of them) -->
    <div class="dot dot-1"></div>
    <div class="dot dot-2"></div>
    <div class="dot dot-3"></div>
    <div class="dot dot-4"></div>
    <div class="dot dot-5"></div>
    <div class="dot dot-6"></div>
    <div class="dot dot-7"></div>
    <div class="dot dot-8"></div>

    <svg height="40" width="40" viewBox="0 0 320 320" class="h h-1">
      <path class="path" d="M 160 145 c 15 -90 170 -20 0 90 m 0 -90 c -15 -90 -170 -20 0 90">
    </svg>
    <svg height="40" width="40" viewBox="0 0 320 320" class="h h-2">
      <path class="path" d="M 160 145 c 15 -90 170 -20 0 90 m 0 -90 c -15 -90 -170 -20 0 90">
    </svg>
    <svg height="40" width="40" viewBox="0 0 320 320" class="h h-3">
      <path class="path" d="M 160 145 c 15 -90 170 -20 0 90 m 0 -90 c -15 -90 -170 -20 0 90">
    </svg>
    <svg height="40" width="40" viewBox="0 0 320 320" class="h h-4">
      <path class="path" d="M 160 145 c 15 -90 170 -20 0 90 m 0 -90 c -15 -90 -170 -20 0 90">
    </svg>

    <svg height="40" width="40" viewBox="0 0 320 320" class="h h-5">
      <path class="path" d="M 160 145 c 15 -90 170 -20 0 90 m 0 -90 c -15 -90 -170 -20 0 90">
    </svg>
    <svg height="40" width="40" viewBox="0 0 320 320" class="h h-6">
      <path class="path" d="M 160 145 c 15 -90 170 -20 0 90 m 0 -90 c -15 -90 -170 -20 0 90">
    </svg>
    <svg height="40" width="40" viewBox="0 0 320 320" class="h h-7">
      <path class="path" d="M 160 145 c 15 -90 170 -20 0 90 m 0 -90 c -15 -90 -170 -20 0 90">
    </svg>
    <svg height="40" width="40" viewBox="0 0 320 320" class="h h-8">
      <path class="path" d="M 160 145 c 15 -90 170 -20 0 90 m 0 -90 c -15 -90 -170 -20 0 90">
    </svg>

    <svg height="110" width="110" viewBox="0 0 320 320" class="fly fly-1">
      <path class="path" d="M 160 145 c 15 -90 170 -20 0 90 m 0 -90 c -15 -90 -170 -20 0 90">
    </svg>
    <svg height="110" width="110" viewBox="0 0 320 320" class="fly fly-2">
      <path class="path" d="M 160 145 c 15 -90 170 -20 0 90 m 0 -90 c -15 -90 -170 -20 0 90">
    </svg>

  </div>
  <pre id="box">
    <div id="code"></div>
    <div id="paper"></div>
  </pre>
  <div id="showPic" class="dsn">
    <img id="showBig">
  </div>
  <div id="outerdiv"
    style="position:fixed;top:0;left:0;background:rgba(0,0,0,0.7);z-index:2;width:100%;height:100%;display:none;">
    <div id="innerdiv" style="position:absolute;">
      <img id="bigimg" style="border:5px solid #fff;" src="" />
    </div>
  </div>
  <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
  <script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/prism.min.js">
  </script>
  <script>
    $(function () {
      //实现图片的预加载
      function preloadImg(srcArr) {
        if (srcArr instanceof Array) {
          for (var i = 0; i < srcArr.length; i++) {
            var oImg = new Image();
            oImg.src = srcArr[i];
          }
        }
      }
      function getVideoImg() {
        var canvas = document.createElement('canvas')
        var video = $('.video')[0];
        video.setAttribute('crossOrigin', 'anonymous')
        canvas.width = video.clientWidth
        canvas.height = video.clientHeight
        video.onloadeddata = (() => {
          canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height)
          var dataURL = canvas.toDataURL('image/png')
          // img.src = dataURL;    
          console.log('dataURL', dataURL)
          return dataURL;
        })
        // canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height)
        // var dataURL = canvas.toDataURL('image/png')
        // return dataURL;
      }
      //预加载图片
      preloadImg(['./media/0.jpeg', './media/11.jpeg', './media/12.jpeg', './media/13.jpeg', './media/14.jpeg', './media/15.jpeg', './media/16.jpeg', './media/17.jpeg', './media/18.jpeg']);  //参数是一个url数组
      // preloadVideo(['./media/2.mp4'])
      var result = ` /*
    你好，我是小企儿。
    这是爸爸送给我的礼物，现在分享给大家：
    首先准备一些样式
  */
  * {
    transition: all 1s;
    padding: 0;
    margin: 0;
    box-sizing: border-box;
  }
  html {
    background: #ddd;
    font-size: 16px;
  }
  body {
    perspective: 1000px;
  }
  #box {
    transform-style: preserve-3d;
    position: relative;
    width: 100vw;
    height: 100vh;
    padding: 16px;
  }
  #code {
    position: absolute;
    left: 0;
    top: 0;
    width: 100vw;
    box-shadow: 0px 20px 50px #555;
  }
  #paper {
    position: absolute;
    right: 0;
    top: 0;
    width: 100vw;
    height: 100vh;
    box-shadow: 0px 20px 50px rgba(255,0,,156,0.8);
  }
  /* 我需要一点代码高亮 */
  .token.selector {
    color: #690;
  }
  .token.property {
    color: #905;
  }
  .token.function {
    color: #dd4a68;
  }
  /* 加点3D效果 */
  #code {
    transform-origin: left center;
    transform: rotate3d(0,1,0,30deg);
    box-shadow: 0px 20px 100px #999;
  }
  /* 我需要一张粉粉的纸 */
  #paper {
    transform-origin: right center;
    transform: rotate3d(0,1,0,-30deg);
    box-shadow: 0px 20px 50px rgba(255,0,,156,0.3);
    background: pink;
  }
  .content{
    width: 100%;
    height: 100%;
    padding: 16px;
  }
  .title {
    font-size: 16px;
  }
  .des {
    text-indent: 2em;
    white-space: normal;
    font-size: 14px;
  }
  .displayArea {
    display: flex;
    flex-direction: column;
  }
  .displayArea p {
    display: flex;
    justify-content: space-between;
    margin-bottom: 5px;
  }
  .displayArea img {
    width: 30%;
    height: 25vh;
  }
  .displayArea video {
    width: 30%;
    height: 25vh;
  }
  `;
      var n = 0;
      var id = setInterval(() => {
        n += 1;
        code.innerHTML = result.substring(0, n)
        code.innerHTML = Prism.highlight(code.innerHTML, Prism.languages.css)
        code.scrollTop = code.scrollHeight;
        styleTag.innerHTML = result.substring(0, n)
        if (n >= result.length) {
          clearInterval(id)
          fn2()
          fn3(result)
        }
      }, 10)

      function fn2() {
        var content = document.createElement('pre')
        content.className = 'content'
        paper.appendChild(content)
        document.body.appendChild(paper);
      }

      function fn3(preResult) {
        var result = ''
        var md = `<h1 class="title">爸爸想对你说:</h1><p class="des">小企儿，你好呀，今天是3月14号，你的生日，刚好今天也是周六，爸爸祝你生日快乐哈。因为新冠状病毒疫情原因，你跟妈妈和爷爷奶奶就在老家过生日了哈，爸爸因为要工作就不能在老家啦!但是爸爸永远爱你喔！！！</p>
        <div id="displayArea" class="displayArea"><p><img class="img" src="./media/11.jpeg" /><img class="img" src="./media/12.jpeg" /><img class="img" src="./media/13.jpeg" /></p><p><img class="img" src="./media/14.jpeg" /><img id="videoShow" src="./media/0.jpeg" /><img class="img" src="./media/15.jpeg" /></p><p><img class="img" src="./media/16.jpeg" /><img class="img" src="./media/17.jpeg" /><img class="img" src="./media/18.jpeg" /></p></div>`
        var n = 0;
        var id = setInterval(() => {
          n += 1;
          code.innerHTML = preResult + result.substring(0, n)
          code.innerHTML = Prism.highlight(preResult + result.substring(0, n), Prism.languages.css)
          code.scrollTop = code.scrollHeight;
          styleTag.innerHTML = preResult + result.substring(0, n)
          if (n >= result.length) {
            clearInterval(id)
            writeMarkdown(md, event)
          }
        }, 10)
      }

      function event() {
        $("#displayArea").on('click', '.img', function () {
          var _this = $(this);//将当前的pimg元素作为_this传入函数  
          imgShow("#outerdiv", "#innerdiv", "#bigimg", _this);
        });
        $('#videoShow').click(function () {
          $('.videoBox').addClass('videoBoxL')
          $('.close').click(function () {
            $('.videoBox').removeClass('videoBoxL')
          })
        })
        $('#loveSvg').fadeIn(1000)
      }

      function imgShow(outerdiv, innerdiv, bigimg, _this) {
        var src = _this.attr("src");//获取当前点击的pimg元素中的src属性  
        $(bigimg).attr("src", src);//设置#bigimg元素的src属性 
        /*获取当前点击图片的真实大小，并显示弹出层及大图*/
        var windowW = $(window).width();//获取当前窗口宽度  
        var windowH = $(window).height();//获取当前窗口高度  
        var realWidth = $(_this)[0].naturalWidth;//获取图片真实宽度  
        var realHeight = $(_this)[0].naturalHeight;//获取图片真实高度  
        var imgWidth, imgHeight;
        var scale = 0.8;
        if (windowW / realWidth > windowH / realHeight) {
          scale = (windowH * 0.9 / realHeight)
        } else {
          scale = (windowW * 0.9 / realWidth)
        }
        // var scale = Math.min(Math.floor(windowW / realWidth), Math.floor(windowH / realHeight));//缩放尺寸，当图片真实宽度和高度大于窗口宽度和高度时进行缩放  

        // if (realHeight > windowH * scale) {//判断图片高度  
        //   imgHeight = windowH * scale;//如大于窗口高度，图片高度进行缩放  
        //   imgWidth = imgHeight / realHeight * realWidth;//等比例缩放宽度  
        //   if (imgWidth > windowW * scale) {//如宽度扔大于窗口宽度  
        //     imgWidth = windowW * scale;//再对宽度进行缩放  
        //   }
        // } else if (realWidth > windowW * scale) {//如图片高度合适，判断图片宽度  
        //   imgWidth = windowW * scale;//如大于窗口宽度，图片宽度进行缩放  
        //   imgHeight = imgWidth / realWidth * realHeight;//等比例缩放高度  
        // } else {//如果图片真实高度和宽度都符合要求，高宽不变  
        //   imgWidth = realWidth;
        //   imgHeight = realHeight;
        // }
        imgWidth = realWidth * scale;
        imgHeight = realHeight * scale;
        console.log(realWidth, realHeight)
        console.log(windowW, windowH, scale)
        $(bigimg).css("width", imgWidth);//以最终的宽度对图片缩放  

        var w = (windowW - imgWidth) / 2;//计算图片与窗口左边距  
        var h = (windowH - imgHeight) / 2;//计算图片与窗口上边距  
        $(innerdiv).css({ "top": h, "left": w });//设置#innerdiv的top和left属性  
        $(outerdiv).fadeIn("fast");//淡入显示#outerdiv及.pimg  

        $(outerdiv).click(function () {//再次点击淡出消失弹出层  
          $(this).fadeOut("fast");
        });
      }

      function writeMarkdown(markdown, fn) {
        var domContent = document.querySelector('#paper>.content')
        var n = 0;
        var id = setInterval(() => {
          n += 1;
          domContent.innerHTML = markdown.substring(0, n)
          domContent.scrollTop = domContent.scrollHeight;
          if (n >= markdown.length) {
            clearInterval(id)
            fn.call()
            // marked.js (markdown -> html)
            // html add css
          }
        }, 10)
      }
    })
  </script>
</body>

</html>